
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>SDWebImage : NSURLErrorDomain - Code=406 - My Octopress Blog</title>
  <meta name="author" content="Your Name">

  
  <meta name="description" content="The iOS project that I am working on, has decided to use some caching mechanism to improve perfomance and save bandwidth of the user. So as per the &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://uiroshan.github.io/blog/2015/01/25/sdwebimage-nsurlerrordomain-code-equals-406/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My Octopress Blog</a></h1>
  
    <h2>A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="uiroshan.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">SDWebImage : NSURLErrorDomain - Code=406</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-25T15:27:51+05:30'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>3:27 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>The iOS project that I am working on, has decided to use some caching mechanism to improve perfomance and save bandwidth of the user. So as per the recommendation of some blogs and popularity, we have decided to go with SDWebImage cache. After inspecting example code and trying out some sample code I thought it&rsquo;ll be good to use.</p>

<p>But it wasn&rsquo;t work with images those are retrieved from our sever. I have hardcoded public images found from the image search. There wasn&rsquo;t any problem with those. I tried with different methods provided from the API. But the result is the same.</p>

<p>I am getting following error instead of successful response.</p>

<blockquote><p>Error Domain=NSURLErrorDomain Code=406 &ldquo;The operation couldnâ€™t be completed. (NSURLErrorDomain error 406.)&rdquo;</p></blockquote>

<p>Following is the definition I found from the Wikipedia for HTTP status code 406.</p>

<blockquote><p>406 Not Acceptable - The requested resource is only capable of generating content not acceptable according to the Accept headers sent in the request.</p></blockquote>

<p>I couldn&rsquo;t find any satisfiable answers from any Q/A sites. So I have decided to read the source code and identify any possible problem / solution.</p>

<p>After going through several classes, I found that <code>SDWebImageDownloader</code> class has a code related to setting the <code>'Accept'</code> header value into the request.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">_HTTPHeaders</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableDictionary</span> <span class="nl">dictionaryWithObject</span><span class="p">:</span><span class="s">@&quot;image/webp,image/*;q=0.8&quot;</span>
</span><span class='line'>                                                <span class="nl">forKey</span><span class="p">:</span><span class="s">@&quot;Accept&quot;</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>So above code caused me the problem. Once I changed it, caching started to work and work nicely. But that was a temporary solution, because it&rsquo;s not good to change library source code.</p>

<p>I was using <code>UIImageView</code> category provided by the library to retrieve and cache images. So it was problematic to set header values from there. Also only <code>SDWebImageDownloader</code> class providing the necessary API method to change the header value for public users. So at first sight I was so disappointed and thought of trying something else. But luckily <code>SDWebImageDownloader</code> is a singleton object. Every method is using the <code>SDWebImageDownloader downloadImageWithURL:options:progress:completed:</code> method to download images. So I have set a custom header value to <code>'Accept'</code> header to override the default header.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">SDWebImageDownloader</span><span class="p">.</span><span class="n">sharedDownloader</span> <span class="nl">setValue</span><span class="p">:</span><span class="s">@&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&quot;</span>
</span><span class='line'>                             <span class="nl">forHTTPHeaderField</span><span class="p">:</span><span class="s">@&quot;Accept&quot;</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span> <span class="nl">sd_setImageWithURL</span><span class="p">:[</span><span class="nb">self</span> <span class="nl">imageUrlForId</span><span class="p">:</span><span class="n">imageId</span><span class="p">]</span> <span class="nl">placeholderImage</span><span class="p">:</span><span class="n">image</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Your Name</span></span>

      




<time class='entry-date' datetime='2015-01-25T15:27:51+05:30'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>3:27 pm</span></time>
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://uiroshan.github.io/blog/2015/01/25/sdwebimage-nsurlerrordomain-code-equals-406/" data-via="" data-counturl="http://uiroshan.github.io/blog/2015/01/25/sdwebimage-nsurlerrordomain-code-equals-406/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/01/25/sdwebimage-nsurlerrordomain-code-equals-406/">SDWebImage : NSURLErrorDomain - Code=406</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Your Name -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
