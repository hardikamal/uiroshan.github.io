<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8">
  <title>My Octopress Blog</title>
  <meta name="author" content="Your Name">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://uiroshan.github.io/">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">

  <!-- http://opengraphprotocol.org/ -->
  <meta name="twitter:card" content="summary_large_image">
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://uiroshan.github.io/">
  <meta property="og:title" content="My Octopress Blog">
  

  <script src="/javascripts/libs/jquery/jquery-2.1.3.min.js"></script>

<link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">


  
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

  

</head>

  <body   >
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" title="toggle navbar" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">My Octopress Blog</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a rel="index" href="/">Blog</a>
                </li>
                <li >
                    <a href="/blog/archives">Archives</a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <form class="search navbar-form navbar-right" action="https://www.google.com/search" method="GET">
                            <input type="hidden" name="sitesearch" value="uiroshan.github.io">
                            <div class="form-group">
                                <input class="form-control" type="text" name="q" placeholder="Search">
                            </div>
                        </form>
                    </li>
                
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</nav>


      </header>
      <div id="main" role="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9">
    <div class="blog-index" itemscope itemtype="http://schema.org/Blog">
    <meta itemprop="name" content="My Octopress Blog" />
    
    <meta itemprop="url" content="http://uiroshan.github.io" />
      
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2015-01-25T15:27:51+05:30"  data-updated="true" itemprop="datePublished dateCreated">ordinal</time>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/2015/01/25/sdwebimage-nsurlerrordomain-code-equals-406/" itemprop="url">SDWebImage : NSURLErrorDomain - Code=406</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>The iOS project that I am working on, has decided to use some caching mechanism to improve perfomance and save bandwidth of the user. So as per the recommendation of some blogs and popularity, we have decided to go with SDWebImage cache. After inspecting example code and trying out some sample code I thought it&rsquo;ll be good to use.</p>

<p>But it wasn&rsquo;t work with images those are retrieved from our sever. I have hardcoded public images found from the image search. There wasn&rsquo;t any problem with those. I tried with different methods provided from the API. But the result is the same.</p>

<p>I am getting following error instead of successful response.</p>

<blockquote><p>Error Domain=NSURLErrorDomain Code=406 &ldquo;The operation couldnâ€™t be completed. (NSURLErrorDomain error 406.)&rdquo;</p></blockquote>

<p>Following is the definition I found from the Wikipedia for HTTP status code 406.</p>

<blockquote><p>406 Not Acceptable - The requested resource is only capable of generating content not acceptable according to the Accept headers sent in the request.</p></blockquote>

<p>I couldn&rsquo;t find any satisfiable answers from any Q/A sites. So I have decided to read the source code and identify any possible problem / solution.</p>

<p>After going through several classes, I found that <code>SDWebImageDownloader</code> class has a code related to setting the <code>'Accept'</code> header value into the request.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">_HTTPHeaders</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableDictionary</span> <span class="nl">dictionaryWithObject</span><span class="p">:</span><span class="s">@&quot;image/webp,image/*;q=0.8&quot;</span>
</span><span class='line'>                                                <span class="nl">forKey</span><span class="p">:</span><span class="s">@&quot;Accept&quot;</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>So above code caused me the problem. Once I changed it, caching started to work and work nicely. But that was a temporary solution, because it&rsquo;s not good to change library source code.</p>

<p>I was using <code>UIImageView</code> category provided by the library to retrieve and cache images. So it was problematic to set header values from there. Also only <code>SDWebImageDownloader</code> class providing the necessary API method to change the header value for public users. So at first sight I was so disappointed and thought of trying something else. But luckily <code>SDWebImageDownloader</code> is a singleton object. Every method is using the <code>SDWebImageDownloader downloadImageWithURL:options:progress:completed:</code> method to download images. So I have set a custom header value to <code>'Accept'</code> header to override the default header.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="n">SDWebImageDownloader</span><span class="p">.</span><span class="n">sharedDownloader</span> <span class="nl">setValue</span><span class="p">:</span><span class="s">@&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&quot;</span>
</span><span class='line'>                             <span class="nl">forHTTPHeaderField</span><span class="p">:</span><span class="s">@&quot;Accept&quot;</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span> <span class="nl">sd_setImageWithURL</span><span class="p">:[</span><span class="nb">self</span> <span class="nl">imageUrlForId</span><span class="p">:</span><span class="n">imageId</span><span class="p">]</span> <span class="nl">placeholderImage</span><span class="p">:</span><span class="n">image</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>
</div>
  
  


        </article>
      
    </div>

    <ul class="pager">
      
        <li class="previous disabled"><a href="#">&larr;&nbsp;Older</a></li>
      
      <li><a href="/blog/archives">Blog Archives</a></li>
      
        <li class="next disabled"><a href="#">Newer&nbsp;&rarr;</a></li>
      
    </ul>
  </div>

  
    <aside class="sidebar col-md-3">
      
        <section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item " href="/blog/2015/01/25/sdwebimage-nsurlerrordomain-code-equals-406/">SDWebImage : NSURLErrorDomain - Code=406</a>
    
  </div>
</section>






      
    </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2015 - Your Name<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


<script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr.js"></script>


  </body>
</html>
